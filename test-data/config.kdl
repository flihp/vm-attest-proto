key-pair "test-root" {
    p384
}

entity "test-root" {
    country-name "US"
    organization-name "Oxide Computer Company"
    common-name "test-root"
}

certificate "test-root" {
    issuer-entity "test-root"
    issuer-key "test-root"

    subject-entity "test-root"
    subject-key "test-root"

    digest-algorithm "sha-384"
    not-after "9999-12-31T23:59:59Z"
    serial-number "00"

    extensions {
        subject-key-identifier critical=false

        basic-constraints critical=true ca=true
        key-usage critical=true {
            key-cert-sign
            crl-sign
        }
        certificate-policies critical=true {
            oana-platform-identity
            tcg-dice-kp-identity-init
            tcg-dice-kp-attest-init
            tcg-dice-kp-eca
        }
    }
}

key-pair "test-intermediate" {
    p384
}

entity "test-intermediate" {
    country-name "US"
    organization-name "Oxide Computer Company"
    common-name "test-intermediate"
}

certificate "test-intermediate" {
    issuer-certificate "test-root"
    issuer-key "test-root"

    subject-entity "test-intermediate"
    subject-key "test-intermediate"

    digest-algorithm "sha-384"
    not-after "9999-12-31T23:59:59Z"
    serial-number "01"

    extensions {
        subject-key-identifier critical=false
        authority-key-identifier critical=false {
            key-id
        }

        basic-constraints critical=true ca=true
        key-usage critical=true {
            key-cert-sign
            crl-sign
        }
        certificate-policies critical=true {
            oana-platform-identity
            tcg-dice-kp-identity-init
            tcg-dice-kp-attest-init
            tcg-dice-kp-eca
        }
    }
}

/// Device 1
key-pair "test-platform-id" {
    ed25519
}

entity "test-platform-id" {
    country-name "US"
    organization-name "Oxide Computer Company"
    common-name "PDV2:PPP-PPPPPPP:RRR:00000000001"
}

certificate "test-platform-id" {
    issuer-certificate "test-intermediate"
    issuer-key "test-intermediate"

    subject-entity "test-platform-id"
    subject-key "test-platform-id"

    digest-algorithm "sha-384"
    not-after "9999-12-31T23:59:59Z"
    serial-number "1001"

    extensions {
        subject-key-identifier critical=false
        authority-key-identifier critical=false {
            key-id
        }

        basic-constraints critical=true ca=true
        key-usage critical=true {
            key-cert-sign
            crl-sign
        }
        certificate-policies critical=true {
            oana-platform-identity
            tcg-dice-kp-identity-init
            tcg-dice-kp-attest-init
            tcg-dice-kp-eca
        }
    }
}

key-pair "test-device-id" {
    ed25519
}

entity "test-device-id" {
    country-name "US"
    organization-name "Oxide Computer Company"
    common-name "test-device-id"
}

certificate "test-device-id" {
    issuer-certificate "test-platform-id"
    issuer-key "test-platform-id"

    subject-entity "test-device-id"
    subject-key "test-device-id"

    digest-algorithm "sha-512"
    not-after "9999-12-31T23:59:59Z"
    serial-number "2001"

    extensions {
        subject-key-identifier critical=false
        authority-key-identifier critical=false {
            key-id
        }

        basic-constraints critical=true ca=true
        key-usage critical=true {
            key-cert-sign
            crl-sign
        }
        certificate-policies critical=true {
            oana-platform-identity
            tcg-dice-kp-identity-init
            tcg-dice-kp-attest-init
            tcg-dice-kp-eca
        }
    }
}

key-pair "test-alias" {
    ed25519
}

entity "test-alias" {
    country-name "US"
    organization-name "Oxide Computer Company"
    common-name "alias"
}

certificate "test-alias" {
    issuer-certificate "test-device-id"
    issuer-key "test-device-id"

    subject-entity "test-alias"
    subject-key "test-alias"

    not-after "9999-12-31T23:59:59Z"
    serial-number "00"

    extensions {
        basic-constraints critical=true ca=false
        key-usage critical=true {
            digital-signature
        }
        certificate-policies critical=true {
            tcg-dice-kp-attest-init
        }
        dice-tcb-info critical=true {
            fwid-list {
                fwid {
                    digest-algorithm "sha3-256"
                    digest "72fa8f8ea84a42251031366002cbb36281d0131f78cd680436116a720cdd9de5"
                }
            }
        }
    }
}

certificate-list "test-alias" \
    "test-alias" \
    "test-device-id" \
    "test-platform-id" \
    "test-intermediate"
